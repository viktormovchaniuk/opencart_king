{{ header }}
<div class="container">
<ul class="breadcrumb">
{% for breadcrumb in breadcrumbs %}
    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
        </ul>
        {% if error_warning %}
            <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                </div>
                {% endif %}
                <div class="row">
               

                                        <div id="content">
                                        <h1 style="text-align: center">heading_title</h1>

                                        <div class="">
                                        <div class="checkout checkout-checkout">

                                        content_top

                                        <div class="payment">

                                        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 payment-data">
                                        <div class="t-head">
                                        text_customer
                                        </div>
                                        {% if not c_logged %}
                                        <div id="login_warning" class='checkout-content note'>
                                            text_notlogged
                                        </div>

                                        {% endif %}
                                        <div id="payment-address">
                                        <div class="checkout-content" style="overflow: hidden; display: block;">
                                        <div class="fields-group">
                                        {% if c_logged %}
                                        <label for="firstname-ch"> text_full_name :</label><br>
                                        <input type="text" class="form-control large-field" id="firstname-ch" name="firstname"  value="{{ c_name }}" readonly="true" />
                                         {% else %}
                                        <label for="firstname-ch"><span class="required">*</span>   text_full_name :</label><br>
                                        <input type="text" id="firstname-ch" name="firstname" value="" class="form-control large-field">
                                        <span class="error"></span>
                                        {% endif %}
                                        </div>
                                        <div class="fields-group">
                                        <label for="telephone-ch"><span class="required">*</span>   text_telephone:</label><br>
                                        <input type="tel" id="telephone-ch" name="telephone"
                                        value="{{ telephone }}" class="form-control large-field">
                                        <span class="error"></span>

                                        </div>

                                        <div class="fields-group">
                                        <label for="email-ch">   text_email:</label><br>
                                        <input type="text" id="email-ch" name="email" value="{{ email }}"
                                        class="form-control large-field">
                                        <span class="error"></span>

                                        </div>

                                        <div class="fields-group">
                                        <label for="city-ch"><span class="required">*</span>   text_town:</label><br>
                                        <input type="text" id="city-ch" name="city" value="{{ city }}"
                                        class="form-control large-field">
                                        <span class="error"></span>
                                        </div>

                                        <div class="fields-group">
                                        <label for="delivery">  text_delivery_method:</label><br>
                                        <select onChange="updateShipping(this)" name="shipping_method" id="shipping-method" class="form-control large-field">
                                        {% for shipping_method in shippig_methods %}
                                            <option

                                            value='{"title": "{{ shipping_method.title}}", "code": "{{ shipping_method.value}}", "comment":"", "shipping_method":"{{ shipping_method.value}}", "cost":"{{ shipping_method.cost}}","tax_class_id":""}'
                                                class="form-control large-field  substr(shipping_method.value, strpos(shipping_method.value, '.'+1))">{{ shipping_method.title}}</option>

                                                {% endfor %}
                                                </select>
                                                <br>
                                                <!--
                                                <div class="group-check">
                                                <label><input id="to-office" class="delivery-type" type="radio"
                                                name="delivery-type" checked="checked"
                                                value=" text_delivery_type_1">   text_delivery_type_1</label> &nbsp;&nbsp;
                                                <label><input id="to-address" class="delivery-type" type="radio"
                                                name="delivery-type" value=" text_delivery_type_2">   text_delivery_type_2</label>
                                                </div>
                                                -->
                                                <input type='hidden' name='delivery-type' value='delivery' />
                                                <label for='address_1'> text_delivery_type_2:</label><br/>
                                                <input type="text" name="address_1" id="address_1" value="{{ address_1}}"
                                                class="form-control large-field" placeholder="  text_delivery_placeholder">
                                                <span class="error"></span>

                                                </div>
                                                {% if payment_methods %}
                                                <div style="background: red; height: 100px;">
                                                    123
                                                    {% for payment_method in payment_methods %}
                                                        {{payment_methods}}
                                                    {% endfor %} 
                                                </div>
                                                {% endif %}
                                                <div class="fields-group" style="">
                                                <label for="payment_select">  text_payment_method:</label><br>
                                                <select id="payment_select" name="payment_method" class="form-control large-field">
                                                {% for payment_method in payment_methods %}
                                                    <option
                                                        value='{"title": "{{ payment_method.title}}", "code": "{{ payment_method.code}}"}'
                                                        class="payment_method_value {{ payment_method.code}}"
                                                        style="">{{ payment_method.title}}</option>
                                                        {% endfor %}
                                                        </select>
                                                        </div>

                                                        <div class="fields-group">
                                                        <label for="comment_field">  text_comment:</label><br>
                                                        <input type="text" id="comment_field" class="form-control large-field" name="comment"
                                                        value="{{ comment}}">
                                                        </div>
                                                        </div>
                                                        <div class="fields-group">
                                                        {% if modules %}
                                                            <div>
                                                                {% for module in modules %}
                                                                    {{ module}}
                                                                        {% endfor %}{% endif %}
                                                                        </div>

                                                                        </div>

                                                                        </div>
                                                                       </div>
                                                                        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 checkout-data">
                                                                        <div class="cart-info table-responsive">
                                                                        <table class="table">
                                                                        <thead>
                                                                        <tr>
                                                                        <td class="name t-head" colspan="2">  text_product</td>
                                                                        <td class="price t-head">text_price</td>
                                                                        <td class="quantity t-head">text_quantity</td>
                                                                        </tr>
                                                                         </thead>
                                                                        <tbody>
                                                                        {% for product in products %}
                                                                            <tr>
                                                                                <td class="image">
                                                                                    <a href="/index.php?route=product/product&product_id={{ product.product_id}}"
                                                                                       title="{{ product.name}}">

                                                                                        <img src="{{  product.thumb}}" style="max-width: 100px" alt="{{ product.name}}">
                                                                                    </a>

                                                                                </td>
                                                                                <td class="name">
                                                                                <a href="/index.php?route=product/product&product_id={{ product.product_id}}">{{ product.name}}</a>
                                                                                <div class="p-model">
                                                                                {{ product.model}}                                </div>
                                                                                <div class="cart-option">
                                                                                {% for option in product %}
                                                                                    -
                                                                                        <small>{{ option.name}}
                                                                                        : {{ option.value }}</small><br/>
                                                                                        {% endfor %}
                                                                                        {% if product.recurring %}
                                                                                        -
                                                                                        <small>{{ text_payment_profile}}
                                                                                        : {{ product.profile_name}}</small>
                                                                                        {% endif %}
                                                                                        </div>
                                                                                        </td>
                                                                                        <td class="price">{{ product.price}}   </td>
                                                                                        <td class="quantity">{{ product.quantity}}   </td>
                                                                                        </tr>

                                                                                        {% endfor %}
                                                                                        </table>
                                                                                        <hr/>
                                                                                        <table id='totals' class='table'>
                                                                                        <tbody>
            {% for total in totals %}
            <tr class="subtotal">
              <td class="name subtotal"><strong>{{ total.title }}:</strong></td>
              <td class="price">{{ total.text }}</td>
            </tr>
            {% endfor %}
 
                                                                                        </tbody>
                                                                                        </table> 
                        <div class="txt_zak">
                        Нажимая на кнопку ОФОРМИТЬ ЗАКАЗ Вы даете согласие на обработку указанных персональных данных в соответствии с законом Украины "О защите персональных данных" от 01.06.2010 № 2297-VI  и подтверждаете, что ознакомлены с <a href="/privacy" target="_blank">политикой безопасности </a>компании
                        </div>

                                                                                        <div id="confirm">
                                                                        <div class="payment">
                                                                        <div id="ajax-button-confirm" class=" btn btn-lg btn-success">
                                                                        text_confirm
                                                                        </div>
                                                                        <a href='index.php?route=checkout/cart'>
                                                                        <div id="button-modify" class=" btn btn-lg btn-cancel">
                                                                        text_cart
                                                                        </div>
                                                                        </a>
                                                                        </div>

                                                                        </div>
 
                                                                                        </div>
                                                                                                                                                                                <div class="col-xs-12 checkout-subinfo">
                                                                                        content_bottom
                                                                                        </div>
                                                                                        </div>
                                                                                        </div>
                                                                                        </div>
                                                                                        {{ column_right }}</div>
                                                                                        </div>
                    <div id="LoginModal" class="modal fade" role="dialog">
                        <div class="modal-dialog">

                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h3>{{ text_returning_customer }}</h3>
                                </div>
                                <div class="modal-body">

                                    <p><strong>{{ text_i_am_returning_customer }}</strong></p>
                                    <form  method="post" enctype="multipart/form-data">
                                        <div class="form-group">
                                            <label class="control-label" for="input-email">{{ entry_email }}</label>
                                            <input type="text" name="email" value="{{ email }}" placeholder="{{ entry_email }}" id="input-email" class="form-control" />
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label" for="input-password">{{ entry_password }}</label>
                                            <input type="password" name="password" value="" placeholder="{{ entry_password }}" id="input-password" class="form-control" />
                                            <a class="pull-right" href="{{ forgotten }}">{{ text_forgotten }}</a></div>
                                        <div class="btn btn-primary submit-login-form" >{{ button_login }}</div>
                                        <div class="text-right">
                                            <a href="{{ register}}"> text_register</a>

                                        </div>

                                    </form>
                                    <div class="errors-block"></div>
                                </div>
                                </div>

                            </div>

                        </div>
                    </div>
    <div class="hiden_payment_info"  style="display:none;"></div>

    <script type="text/javascript"><!--

function updateShipping(s) {
    shp = JSON.parse(s.value)
    $.ajax({
        url: 'index.php?route=checkout/shipping_method/save',
        type: 'post',
        data: shp,
        dataType: 'json',
        beforeSend: function() {
            $('#shipping-method').addClass('loading');
		},
        success: function(json) {
            $('.alert, .text-danger').remove();

            //if (json['redirect']) {
            //    location = json['redirect'];
            //}
            if (json['error']) {
                if (json['error']['warning']) {
                 // Error ylanyrkkaan....
                 alert(json['error']['warning']);
                }
            } else {
                $.ajax({
                    url: 'index.php?route=checkout/onepagecheckout/totals',
                    type: 'get',
                    success: function(json) {
                        $('#totals tbody').remove();
                        $('#totals').append('<tbody></tbody');
                        for (t in json['totals']) {
                            $('#totals tbody').append('<tr class="name subtotal"><td class="name subtotal"><strong>'+json['totals'][t]['title']+'</strong></td><td class="price">'+json['totals'][t]["text"]+'</td></tr>');
                            }
                    }
                    });
                // Update Totalsi!
            }
            $('#shipping-method').removeClass('loading');
        },
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
        }
        ); //ajax
}

$(document).ready(function () {

    $(' #LoginModal .submit-login-form ').on('click', function(){
        $.ajax({
                url: 'index.php?route=checkout/onepagecheckout/AjaxLogin',
                type: 'post',
                data: $('#LoginModal #input-email, #LoginModal #input-password '),
                dataType: 'json',
                beforeSend: function() {

                },
                success: function(json) {
                    console.log(json);
                   if(json.errors!=0){
                       if(typeof json.errors.warning!='undefined' && json.errors.warning!='')
                       $('#LoginModal .errors-block').html(json.errors.warning) ;
                       if(typeof json.errors.errors!='undefined'&& json.errors.errors!='')
                       $('#LoginModal .errors-block').append( '<br>' + json.errors.error ) ;
                   }
                   else if(json.errors==0){
                       $('#firstname-ch').prop('value',json.c_name);
                       $('#city-ch').prop('value',json.city);
                       $('#address_1').prop('value',json.address_1);
                       $('#email-ch').prop('value',json.email);
                       $('#telephone-ch').prop('value',json.telephone);
                       $('#LoginModal').modal('hide');
                       $('#login_warning').html('');
                   }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            }
        ); //ajax
        return false;
    });

            $('#ajax-button-confirm').on('click', function () {

$.ajax({
url: 'index.php?route=checkout/onepagecheckout',
type: 'post',
data: $('.checkout-checkout .payment-data input[type=\'text\'], .checkout-checkout .payment-data input[type=\'tel\'], .checkout-checkout .payment-data input[type=\'radio\']:checked, .checkout-checkout .payment-datainput input[type=\'checkbox\']:checked, .checkout-checkout .payment-data  select '),
dataType: 'json',
beforeSend: function () {
$('#ajax-button-confirm').addClass('preloader');

},
complete: function () {
$('#ajax-button-confirm').removeClass('preloader');

},
success: function (json) {
console.log(json);

if (json.error) {
if (json['error']['firstname']) {
$('#firstname-ch+.error').html(json['error']['firstname']);
}


if (json['error']['email']) {
    $('#email-ch+.error').html(json['error']['email']);
}

if (json['error']['telephone']) {
    $('#telephone-ch+.error').html(json['error']['telephone']);
}

if (json['error']['address_1']) {
    $('#address_1+.error').html(json['error']['address_1']);
}

if (json['error']['city']) {
    $('#city-ch+.error').html(json['error']['city']);
}
}

else if(json['cod']) {
    $.ajax({
        type: 'get',
        url: 'index.php?route=extension/payment/cod/confirm',
        cache: false,
        beforeSend: function() {
            $('#ajax-button-confirm').button('loading');
        },
        complete: function() {
            $('#ajax-button-confirm').button('reset');
        },
        success: function() {
            location = 'index.php?route=checkout/success';
        }
    });
}

else if(json['payment']) {
    $('.hiden_payment_info').html(json['payment']);
    console.log($('.hiden_payment_info a').attr('href'));
    location = $('.hiden_payment_info a').attr('href');
}
else {
    if (json.credit)
        credit_confirm('/index.php?route=checkout/part_payment_cart/getResult&from_privat24=true');
   /* else
        location = 'index.php?route=checkout/success'*/

}
},
error: function (xhr, ajaxOptions, thrownError) {
           alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
       }
});


});


});
//--></script>

{{ footer }}
